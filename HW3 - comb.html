<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8">
<title>Оглеждане без прескачане</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body { margin:0; overflow:hidden; background:#000; }
#btn {
	position:absolute;
	top:50%; left:50%;
	transform:translate(-50%,-50%);
	padding:16px 24px;
	font-size:18px;
}
</style>
</head>
<body>

<button id="btn">Разреши движение</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
let scene, camera, renderer;

// ---- параметри ----
const SMOOTH = 0.15;
const MAX_PITCH = THREE.MathUtils.degToRad(85);

let yaw = 0;
let pitch = 0;
let targetYaw = 0;
let targetPitch = 0;

init();
animate();

function init() {
	scene = new THREE.Scene();

	camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
	camera.position.set(0,0,0);

	renderer = new THREE.WebGLRenderer({antialias:true});
	renderer.setSize(innerWidth, innerHeight);
	document.body.appendChild(renderer.domElement);

	// стая
	scene.add(new THREE.Mesh(
		new THREE.BoxGeometry(20,10,20),
		new THREE.MeshBasicMaterial({color:0x1faa3a, side:THREE.BackSide})
	));

	// конуси
	const g = new THREE.ConeGeometry(0.3,1,16);
	for(let i=0;i<300;i++){
		const m = new THREE.Mesh(g,new THREE.MeshBasicMaterial({color:Math.random()*0xffffff}));
		const r=Math.random();
		if(r<.2)m.position.set(Math.random()*18-9,-4.5,Math.random()*18-9);
		else if(r<.4)m.position.set(Math.random()*18-9,4.5,Math.random()*18-9);
		else if(r<.6)m.position.set(9.5,Math.random()*8-4,Math.random()*18-9);
		else if(r<.8)m.position.set(-9.5,Math.random()*8-4,Math.random()*18-9);
		else m.position.set(Math.random()*18-9,Math.random()*8-4,9.5);
		scene.add(m);
	}

	window.addEventListener("resize",()=>{
		camera.aspect=innerWidth/innerHeight;
		camera.updateProjectionMatrix();
		renderer.setSize(innerWidth,innerHeight);
	});

	setupOrientation();
}

function setupOrientation(){
	const btn=document.getElementById("btn");
	if(typeof DeviceOrientationEvent?.requestPermission==="function"){
		btn.onclick=()=>{
			DeviceOrientationEvent.requestPermission().then(p=>{
				if(p==="granted"){
					window.addEventListener("deviceorientation",onOrientation,true);
					btn.remove();
				}
			});
		};
	}else{
		btn.remove();
		window.addEventListener("deviceorientation",onOrientation,true);
	}
}

function onOrientation(e){
	// yaw (alpha)
	targetYaw = THREE.MathUtils.degToRad(e.alpha || 0);

	// pitch (beta) – ПРАВИЛНО
	let b = THREE.MathUtils.degToRad(e.beta || 0);
	b = THREE.MathUtils.clamp(b, -MAX_PITCH, MAX_PITCH);
	targetPitch = b;
}

function animate(){
	requestAnimationFrame(animate);

	// плавно изглаждане
	yaw += (targetYaw - yaw) * SMOOTH;
	pitch += (targetPitch - pitch) * SMOOTH;

	camera.rotation.order = "YXZ";
	camera.rotation.y = yaw;
	camera.rotation.x = pitch;

	renderer.render(scene,camera);
}
</script>

</body>
</html>
