<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8">
<title>Стая с случайни конуси и гладко оглеждане</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
	body {
		margin: 0;
		overflow: hidden;
		background: #000;
	}
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
let scene, camera, renderer;

// ориентация
let alpha = 0, beta = 0, gamma = 0;
let alpha0 = null, beta0 = null, gamma0 = null;

// целеви ъгли
let targetYaw = 0, targetPitch = 0, targetRoll = 0;

// реални (изгладени) ъгли
let yaw = 0, pitch = 0, roll = 0;

// колко плавно (0.05–0.15)
const SMOOTH = 0.08;

init();
animate();

function init() {
	scene = new THREE.Scene();

	camera = new THREE.PerspectiveCamera(
		75,
		window.innerWidth / window.innerHeight,
		0.1,
		1000
	);
	camera.position.set(0, 0, 0);

	renderer = new THREE.WebGLRenderer({ antialias: true });
	renderer.setSize(window.innerWidth, window.innerHeight);
	document.body.appendChild(renderer.domElement);

	// ----- СТАЯ -----
	const room = new THREE.Mesh(
		new THREE.BoxGeometry(20, 10, 20),
		new THREE.MeshBasicMaterial({
			color: 0x1faa3a,
			side: THREE.BackSide
		})
	);
	scene.add(room);

	// ----- КОНУСИ -----
	const coneCountPerSurface = 120;
	const coneGeometry = new THREE.ConeGeometry(
		Math.random() * 0.4 + 0.2,
		Math.random() * 1.2 + 0.6,
		16
	);

	function randomColor() {
		return new THREE.Color(
			Math.random(),
			Math.random(),
			Math.random()
		);
	}

	function randomCone() {
		return new THREE.Mesh(
			coneGeometry,
			new THREE.MeshBasicMaterial({ color: randomColor() })
		);
	}

	// под / таван
	for (let i = 0; i < coneCountPerSurface; i++) {
		let c1 = randomCone();
		c1.position.set(
			THREE.MathUtils.randFloat(-9, 9),
			-4.5,
			THREE.MathUtils.randFloat(-9, 9)
		);
		scene.add(c1);

		let c2 = randomCone();
		c2.position.set(
			THREE.MathUtils.randFloat(-9, 9),
			4.5,
			THREE.MathUtils.randFloat(-9, 9)
		);
		scene.add(c2);
	}

	// стени
	for (let i = 0; i < coneCountPerSurface * 2; i++) {
		let c = randomCone();

		const wall = Math.floor(Math.random() * 4);

		if (wall === 0) c.position.set( 9.5, THREE.MathUtils.randFloat(-4, 4), THREE.MathUtils.randFloat(-9, 9));
		if (wall === 1) c.position.set(-9.5, THREE.MathUtils.randFloat(-4, 4), THREE.MathUtils.randFloat(-9, 9));
		if (wall === 2) c.position.set(THREE.MathUtils.randFloat(-9, 9), THREE.MathUtils.randFloat(-4, 4),  9.5);
		if (wall === 3) c.position.set(THREE.MathUtils.randFloat(-9, 9), THREE.MathUtils.randFloat(-4, 4), -9.5);

		scene.add(c);
	}

	window.addEventListener("resize", onResize);
	window.addEventListener("deviceorientation", onOrientation, true);
}

function onResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth, window.innerHeight);
}

// ----- DEVICE ORIENTATION -----
function onOrientation(e) {
	alpha = e.alpha || 0;
	beta  = e.beta  || 0;
	gamma = e.gamma || 0;

	if (alpha0 === null) {
		alpha0 = alpha;
		beta0  = beta;
		gamma0 = gamma;
	}
}

// ----- КАМЕРА (гладка) -----
function updateCamera() {
	if (alpha0 === null) return;

	targetYaw   = THREE.MathUtils.degToRad(alpha - alpha0);
	targetPitch = THREE.MathUtils.clamp(
		THREE.MathUtils.degToRad(beta - beta0),
		-Math.PI / 2,
		 Math.PI / 2
	);
	targetRoll  = THREE.MathUtils.degToRad(gamma - gamma0) * 0.3;

	// изглаждане
	yaw   += (targetYaw   - yaw)   * SMOOTH;
	pitch += (targetPitch - pitch) * SMOOTH;
	roll  += (targetRoll  - roll)  * SMOOTH;

	camera.rotation.order = "YXZ";
	camera.rotation.y = yaw;
	camera.rotation.x = pitch;
	camera.rotation.z = roll;
}

function animate() {
	requestAnimationFrame(animate);
	updateCamera();
	renderer.render(scene, camera);
}
</script>

</body>
</html>
